(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1321],{54604:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/apps/[app_id]/embedded-wallets",function(){return t(5697)}])},5697:function(e,a,t){"use strict";t.r(a),t.d(a,{__N_SSP:function(){return J},default:function(){return X}});var r,d=t(52322),i=t(97729),n=t.n(i),l=t(2784),s=t(30195),o=((r=o||{}).OAUTH_ACCOUNT_SUSPENDED="oauth_account_suspended",r.MISSING_OR_INVALID_PRIVY_APP_ID="missing_or_invalid_privy_app_id",r.MISSING_OR_INVALID_PRIVY_ACCOUNT_ID="missing_or_invalid_privy_account_id",r.MISSING_OR_INVALID_TOKEN="missing_or_invalid_token",r.MISSING_OR_INVALID_MFA="missing_or_invalid_mfa",r.EXPIRED_OR_INVALID_MFA_TOKEN="expired_or_invalid_mfa_token",r.INVALID_DATA="invalid_data",r.INVALID_CREDENTIALS="invalid_credentials",r.INVALID_CAPTCHA="invalid_captcha",r.LINKED_TO_ANOTHER_USER="linked_to_another_user",r.ALLOWLIST_REJECTED="allowlist_rejected",r.CANNOT_UNLINK_EMBEDDED_WALLET="cannot_unlink_embedded_wallet",r.CANNOT_UNLINK_SOLE_ACCOUNT="cannot_unlink_sole_account",r.CANNOT_LINK_MORE_OF_TYPE="cannot_link_more_of_type",r.LINKED_ACCOUNT_NOT_FOUND="linked_account_not_found",r.TOO_MANY_REQUESTS="too_many_requests",r.INVALID_ORIGIN="invalid_origin",r.MISSING_ORIGIN="missing_origin",r.INVALID_NATIVE_APP_ID="invalid_native_app_id",r.TOKEN_ALREADY_USED="token_already_used",r.ALREADY_LOGGED_OUT="already_logged_out",r.NOT_SUPPORTED="not_supported",r.USER_UNSUBSCRIBED="user_unsubscribed",r.MAX_APPS_REACHED="max_apps_reached",r.USER_LIMIT_REACHED="max_accounts_reached",r.DEVICE_REVOKED="device_revoked",r.WALLET_PASSWORD_EXISTS="wallet_password_exists",r.OAUTH_STATE_MISMATCH="oauth_state_mismatch",r.MAX_DENYLIST_ENTRIES_REACHED="max_denylist_entries_reached",r.DISALLOWED_LOGIN_METHOD="disallowed_login_method",r.DISALLOWED_RECOVERY_METHOD="disallowed_recovery_method",r.LEGACY_DASHBOARD_LOGIN_CONFIGURATION="legacy_dashboard_login_configuration",r.CANNOT_SET_PASSWORD="cannot_set_password",r.INVALID_PKCE_PARAMETERS="invalid_pkce_parameters",r),c=class extends Error{status;code;constructor(e,a,t){super(a),this.code=t,this.status=e}toString(){return`${this.constructor.name}: ${this.message}${this.cause?` [cause: ${this.cause}]`:""}`}},_=class extends c{constructor(e,a){super(401,e,a)}};s.z.object({error:s.z.string(),cause:s.z.string().optional(),code:s.z.nativeEnum(o).optional()});var u=t(49857),p=t(50429),w=t(48834).Buffer;async function v(e){let a=e.derivePath("m/3457'/10'/1'/0/".concat(0)),t=Uint8Array.from(w.from(a.privateKey.slice(2),"hex")),r=await (0,p.Cg)(t);return{publicKey:r,privateKey:t}}function m(e){return"0x".concat(p.UG.bytesToHex(e))}var f=t(68407);async function y(e){let{appId:a,rootNode:t,accessToken:r}=e,{publicKey:d}=await v(t);return await f.P3(a,m(d),{accessToken:r,mfaToken:null})}var h=t(81641),I=t(90162),A=t(79489),N=t(99558);async function E(e){let a,{farcasterSignerPrivateKey:t,fid:r,payload:d}=e,i=new h.vK({hubUrl:"https://hub-api.neynar.com",axiosInstance:I.default.create({headers:{api_key:N.Z.NEYNAR_API_KEY}})});if(1===d.type)a="like";else if(2===d.type)a="recast";else throw new A.AY("invalid_request_arguments","Invalid reaction type");if(!d.castId&&!d.targetUrl)throw new A.AY("invalid_request_arguments","Missing castId or targetUrl");let n=await i.submitReaction({type:a,target:d.castId||d.targetUrl},r,m(t));return n}async function g(e){let{farcasterSignerPrivateKey:a,fid:t,payload:r}=e,d=new h.vK({hubUrl:"https://hub-api.neynar.com",axiosInstance:I.default.create({headers:{api_key:N.Z.NEYNAR_API_KEY}})}),i=await d.removeCast(r,t,m(a));return i}async function b(e){let{farcasterSignerPrivateKey:a,fid:t,payload:r}=e,d=new h.vK({hubUrl:"https://hub-api.neynar.com",axiosInstance:I.default.create({headers:{api_key:N.Z.NEYNAR_API_KEY}})}),i=await d.removeLink(r,t,m(a));return i}async function O(e){let{farcasterSignerPrivateKey:a,fid:t,payload:r}=e,d=new h.vK({hubUrl:"https://hub-api.neynar.com",axiosInstance:I.default.create({headers:{api_key:N.Z.NEYNAR_API_KEY}})}),i=await d.submitCast(r,t,m(a));return i}async function T(e){let{farcasterSignerPrivateKey:a,fid:t,payload:r}=e,d=new h.vK({hubUrl:"https://hub-api.neynar.com",axiosInstance:I.default.create({headers:{api_key:N.Z.NEYNAR_API_KEY}})}),i=await d.submitLink(r,t,m(a));return i}var S=t(98437),k=t(8934);async function D(e){let{appId:a,userId:t,address:r}=e;if(!(0,S.uc)(r)&&!(0,S.B0)(r))throw new A.AY("invalid_request_arguments","Failed to initialize wallet: missing or invalid wallet address");let d=k.Z.get({appId:a,userId:t,address:r});if(!d)throw new A.AY("wallet_not_on_device","Failed to initialize wallet: wallet with address '".concat(r,"' not loaded on this device"))}var C=t(7186);async function K(e){var a;let{appId:t,accessToken:r,mfaCode:d,mfaMethod:i,userId:n}=e;if(d&&i)try{let e=await f.bf(t,r,i,d);return C.Z.set({appId:t,userId:n},e),e.token}catch(e){throw C.Z.del({appId:t,userId:n}),new A.AY("missing_or_invalid_mfa","MFA verification failed")}let l=null===(a=C.Z.get({appId:t,userId:n}))||void 0===a?void 0:a.token;return l||(C.Z.del({appId:t,userId:n}),null)}async function R(e){let{mfaCode:a,mfaMethod:t,...r}=e,d=await K({appId:r.appId,accessToken:r.accessToken,mfaCode:a,mfaMethod:t,userId:r.userId});switch(r.method){case"sms":return await f.J_(r.appId,r.accessToken,r.phoneNumber,d);case"totp":return await f.ls(r.appId,r.accessToken,d);default:throw Error("Unknown mfa method")}}var M=t(95253),P=t(90460);async function L(e){let a,{appId:t,userId:r,accessToken:d,publicKey:i,mfaToken:n}=e,l={appId:t,userId:r,address:i},s=k.Z.get(l);if(!s)return null;let{share:o}=s;try{let{share:e}=await f.dq(t,d,i,s.deviceId,n,"solana");a=e}catch(e){if((0,P.A)(e))return k.Z.del(l),null;throw e}try{return await (0,S.MU)({shares:[M.US.decode(o),M.US.decode(a)],expectedPublicKey:i})}catch(e){return k.Z.del(l),null}}async function U(e){var a;let{cachedWallet:t,appId:r,userId:d,publicKey:i,accessToken:n,mfaCode:l,mfaMethod:s}=e,o=null===(a=C.Z.get({appId:r,userId:d}))||void 0===a?void 0:a.token;if(l&&s)try{let e=await f.bf(r,n,s,l);C.Z.set({appId:r,userId:d},e),o=e.token}catch(e){throw new A.AY("missing_or_invalid_mfa","MFA verification failed")}if(t&&!o&&t.keypair.publicKey.toBase58()===i)return t;let c=await L({appId:r,userId:d,accessToken:n,publicKey:i,mfaToken:null!=o?o:null});if(!c)throw new A.AY("wallet_not_on_device","Failed to initialize wallet: wallet with publicKey '".concat(i,"' not loaded on this device"));return{keypair:c.reconstructedKeypair}}async function x(e){switch(e.method){case"sms":return await f.Mc(e.appId,e.accessToken,e.code,e.phoneNumber);case"totp":return await f.GH(e.appId,e.accessToken,e.code);default:throw Error("Unknown mfa method")}}async function Y(e){let{appId:a,userId:t,accessToken:r,method:d,mfaCode:i,mfaMethod:n}=e,l=await K({appId:a,accessToken:r,mfaCode:i,mfaMethod:n,userId:t}),s=await V({appId:a,accessToken:r,method:d,mfaToken:l});return C.Z.del({appId:a,userId:t}),s}async function V(e){let{appId:a,accessToken:t,method:r,mfaToken:d}=e;switch(r){case"sms":return await f.F5(a,t,d);case"totp":return await f.NO(a,t,d);default:throw Error("Unknown mfa method")}}var W=t(46686);function Z(e){let{allowedOrigins:a,url:t}=e,r=new URL(t);if(0===a.length||a.some(e=>"*"===e.trim()))return!0;for(let e of a)if(r.origin===e||(function(e){let a=e.replace(/\./g,"\\.").replace(/\*/g,"[^.]*");return new RegExp("^".concat(a,"$"))})(e).test(r.origin))return!0;return!1}function F(e){let{ReactNativeWebView:a}=e;return!!(a&&navigator.userAgent.includes("Android"))}let j={"privy:wallet:create":"embedded_wallet_iframe_create","privy:wallet:create-additional":"embedded_wallet_iframe_create_additional","privy:wallet:set-recovery-password":"embedded_wallet_iframe_set_recovery_password","privy:wallet:recover":"embedded_wallet_iframe_recover","privy:wallet:rpc":"embedded_wallet_iframe_rpc","privy:solana-wallet:create":"embedded_solana_wallet_iframe_create","privy:solana-wallet:recover":"embedded_wallet_iframe_solana_recover","privy:solana-wallet:rpc":"embedded_solana_wallet_iframe_rpc","privy:farcaster:init-signer":"embedded_wallet_iframe_farcaster_signer_init","privy:farcaster:submit-cast":"embedded_wallet_iframe_farcaster_submit_cast","privy:farcaster:remove-cast":"embedded_wallet_iframe_farcaster_remove_cast","privy:farcaster:react-to-cast":"embedded_wallet_iframe_farcaster_react_to_cast","privy:farcaster:submit-link":"embedded_wallet_iframe_farcaster_submit_link","privy:farcaster:remove-link":"embedded_wallet_iframe_farcaster_remove_link"};function G(e,a){var t,r,d;if(window.PRIVY_NATIVE_IOS)try{return null===(t=window.webkit)||void 0===t?void 0:t.messageHandlers.iOSProxy.postMessage(JSON.stringify(e))}catch(e){}if(window.ReactNativeWebView)try{return null===(d=window.ReactNativeWebView)||void 0===d?void 0:null===(r=d.postMessage)||void 0===r?void 0:r.call(d,JSON.stringify(e))}catch(e){}setTimeout(()=>{window.parent&&window.parent.postMessage(e,a)},0)}function H(e,a,t,r){G({id:a,event:t,data:r},e.origin)}function z(e,a,t,r){let d=(0,A.d2)(r)?r.type:A.u$;G({id:a,event:t,error:{type:d,message:r.message}},e.origin)}function B(e){let[a,t]=(0,l.useState)(null),[r,d]=(0,l.useState)(null);function i(e,a,r){C.Z.get({appId:e,userId:a})?t(null):t(r)}function n(e,a,t){C.Z.get({appId:e,userId:a})?d(null):d(t)}return(0,l.useEffect)(()=>{window.location.href.startsWith("http://localhost")||(console.log("%cWarning!","color:#F16552; font-size:50px; font-weight: bold; -webkit-text-stroke: 1px black;"),console.log("%cYou are reading this message because you opened the browser console, a developer tool. Do not enter or paste code you do not understand. Never share your tokens or any other info with anyone. If someone told you to do this, it is very likely a scam.","font-size: 18px;"))},[]),(0,l.useEffect)(()=>{let t=e.appId,d=(0,W._)(t,e.apiUrl);async function l(t){var l,s,c,p,w,m,h,I,N,S,k,M,P;if(!t)return;let L="string"==typeof t.data?JSON.parse(t.data):t.data;if(!("string"==typeof L.event&&/^privy:.+/.test(L.event))||(M=e.allowedDomains,!(window.PRIVY_NATIVE_IOS||window.ReactNativeWebView||Z({allowedOrigins:M,url:t.origin}))))return;if(!(0===(P=e.allowedDomains||[]).length?!(void 0!==location.ancestorOrigins&&location.ancestorOrigins.length>1):void 0===location.ancestorOrigins||!(location.ancestorOrigins.length>0)||[...location.ancestorOrigins].every(e=>Z({allowedOrigins:P,url:e}))))return z(t,L.id,L.event,new _("Frame ancestor is not allowed"));if("privy:iframe:ready"===L.event)return H(t,L.id,L.event,{});if("privy:mfa:clear"===L.event){let a=L.data.userId.replace(/^did:privy:/,"");return C.Z.del({appId:e.appId,userId:a}),H(t,L.id,L.event,{})}let V=L.data.accessToken,F=V?await (0,W.r)(V,d,e.appId):null,{userId:G,appId:B}=null!=F?F:{userId:null,appId:null};try{if(!V||!G||!B)throw new _("Missing valid auth token.");let d=null!==(l=j[L.event])&&void 0!==l?l:"embedded_wallet_iframe_invalid_event",o=f.E2.bind(null,B,V,e.clientAnalyticsId);switch(j.hasOwnProperty(L.event)&&o("".concat(d,"_started")),L.event){case"privy:wallet:create":let{wallet:A}=await (0,u.EK)({appId:B,userId:G,accessToken:V,recoveryPassword:L.data.recoveryPassword,recoveryMethod:L.data.recoveryMethod,recoveryAccessToken:L.data.recoveryAccessToken,recoveryPin:L.data.recoveryPin});return o("".concat(d,"_completed"),{address:A.address}),H(t,L.id,L.event,{address:A.address});case"privy:wallet:create-additional":let{rootNode:N}=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.primaryWalletAddress,walletIndex:0,accessToken:V,mfaCode:null,mfaMethod:null}),S=await (0,u._r)(B,V,L.data,N);return o("".concat(d,"_completed"),{address:S.address}),H(t,L.id,L.event,{address:S.address});case"privy:wallet:set-recovery-password":let{wallet:k}=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod}),C=await (0,u.IA)({appId:B,userId:G,accessToken:V,wallet:k,data:L.data});return o("".concat(d,"_completed"),{address:C.address}),H(t,L.id,L.event,{address:C.address});case"privy:wallet:connect":return await D({appId:B,userId:G,address:L.data.address}),H(t,L.id,L.event,{address:L.data.address});case"privy:wallet:recover":let M=await (0,u.IY)({appId:B,userId:G,accessToken:V,data:L.data});return i(B,G,M),o("".concat(d,"_completed"),{address:M.wallet.address}),H(t,L.id,L.event,{address:M.wallet.address});case"privy:wallet:rpc":let P=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:null!==(s=L.data.hdWalletIndex)&&void 0!==s?s:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});i(B,G,P);let W=await (0,u.YF)(P.wallet,L.data);return o("".concat(d,"_completed"),{address:P.wallet.address,method:W.method}),H(t,L.id,L.event,{address:L.data.address,response:W});case"privy:solana-wallet:create":let{keypair:Z}=await (0,u.ay)({appId:B,userId:G,accessToken:V});return o("".concat(d,"_completed"),{publicKey:Z.publicKey}),H(t,L.id,L.event,{publicKey:Z.publicKey});case"privy:solana-wallet:connect":return await D({appId:B,userId:G,address:L.data.publicKey}),H(t,L.id,L.event,{publicKey:L.data.publicKey});case"privy:solana-wallet:recover":let F=await (0,u.J9)({appId:B,userId:G,accessToken:V,publicKey:L.data.publicKey});return n(B,G,F),o("".concat(d,"_completed"),{publicKey:L.data.publicKey}),H(t,L.id,L.event,{publicKey:L.data.publicKey});case"privy:solana-wallet:rpc":let z=await U({cachedWallet:r,appId:B,userId:G,publicKey:L.data.publicKey,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});n(B,G,z);let J=await (0,u.no)(z.keypair,L.data);return o("".concat(d,"_completed"),{method:J.method,publicKey:L.data.publicKey}),H(t,L.id,L.event,{publicKey:L.data.publicKey,response:J});case"privy:mfa:verify":return await K({appId:B,userId:G,...L.data}),H(t,L.id,L.event,{});case"privy:mfa:init-enrollment":{let e=await R({appId:B,userId:G,...L.data});return H(t,L.id,L.event,{method:L.data.method,secret:e.totpSecret,authUrl:e.totpAuthUrl})}case"privy:mfa:submit-enrollment":return await x({appId:B,...L.data}),H(t,L.id,L.event,{});case"privy:mfa:unenroll":return await Y({appId:B,userId:G,...L.data}),H(t,L.id,L.event,{});case"privy:farcaster:init-signer":{let e=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:null!==(c=L.data.hdWalletIndex)&&void 0!==c?c:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});i(B,G,e);let r=await y({appId:B,rootNode:e.rootNode,accessToken:L.data.accessToken});return o("".concat(d,"_completed"),{address:e.wallet.address}),H(t,L.id,L.event,r)}case"privy:farcaster:submit-cast":{let e=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:null!==(p=L.data.hdWalletIndex)&&void 0!==p?p:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});i(B,G,e);let{privateKey:r}=await v(e.rootNode),n=await O({farcasterSignerPrivateKey:r,fid:Number(L.data.fid),payload:L.data.payload});return o("".concat(d,"_completed"),{address:e.wallet.address}),H(t,L.id,L.event,{response:n})}case"privy:farcaster:remove-cast":{let e=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:null!==(w=L.data.hdWalletIndex)&&void 0!==w?w:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});i(B,G,e);let{privateKey:r}=await v(e.rootNode),n=await g({farcasterSignerPrivateKey:r,fid:Number(L.data.fid),payload:L.data.payload});return o("".concat(d,"_completed"),{address:e.wallet.address}),H(t,L.id,L.event,{response:n})}case"privy:farcaster:react-to-cast":{let e=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:null!==(m=L.data.hdWalletIndex)&&void 0!==m?m:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});i(B,G,e);let{privateKey:r}=await v(e.rootNode),n=await E({farcasterSignerPrivateKey:r,fid:Number(L.data.fid),payload:L.data.payload});return o("".concat(d,"_completed"),{address:e.wallet.address}),H(t,L.id,L.event,{response:n})}case"privy:farcaster:submit-link":{let e=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:null!==(h=L.data.hdWalletIndex)&&void 0!==h?h:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});i(B,G,e);let{privateKey:r}=await v(e.rootNode),n=await T({farcasterSignerPrivateKey:r,fid:Number(L.data.fid),payload:L.data.payload});return o("".concat(d,"_completed"),{address:e.wallet.address}),H(t,L.id,L.event,{response:n})}case"privy:farcaster:remove-link":{let e=await (0,u.js)({cachedWallet:a,appId:B,userId:G,primaryAddress:L.data.address,walletIndex:null!==(I=L.data.hdWalletIndex)&&void 0!==I?I:0,accessToken:V,mfaCode:L.data.mfaCode,mfaMethod:L.data.mfaMethod});i(B,G,e);let{privateKey:r}=await v(e.rootNode),n=await b({farcasterSignerPrivateKey:r,fid:Number(L.data.fid),payload:L.data.payload});return o("".concat(d,"_completed"),{address:e.wallet.address}),H(t,L.id,L.event,{response:n})}}}catch(e){if(function(e){var a,t;let r=null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.code;return"missing_or_invalid_mfa"===r||"expired_or_invalid_mfa_token"===r}(e))return G&&C.Z.del({appId:B,userId:G}),z(t,L.id,L.event,new A.AY("missing_or_invalid_mfa","MFA verification failed"));if(function(e){var a,t,r;let d=null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.code,i=[o.INVALID_DATA,o.NOT_SUPPORTED,o.INVALID_DATA,o.NOT_SUPPORTED,o.USER_UNSUBSCRIBED].includes(d);return(null===(r=e.response)||void 0===r?void 0:r.status)===422&&i}(e))return G&&C.Z.del({appId:B,userId:G}),z(t,L.id,L.event,new A.AY("twilio_verification_failed",null!==(k=null===(S=e.response)||void 0===S?void 0:null===(N=S.data)||void 0===N?void 0:N.error)&&void 0!==k?k:"MFA enrollment failed"));return z(t,L.id,L.event,e)}}return F(window)?document.addEventListener("message",l):window.addEventListener("message",l),()=>{F(window)?document.removeEventListener("message",l):window.removeEventListener("message",l)}},[a,e.allowedDomains,e.appId]),null}var J=!0;function X(e){let{appId:a,clientAnalyticsId:t,allowedDomains:r,apiUrl:i}=e;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n(),{children:(0,d.jsx)("title",{children:"Wallet \xb7 Privy"})}),(0,d.jsx)(B,{appId:a,clientAnalyticsId:t,allowedDomains:r,apiUrl:i})]})}}},function(e){e.O(0,[3999,9034,8199,162,195,4845,7365,6719,9774,2888,179],function(){return e(e.s=54604)}),_N_E=e.O()}]);